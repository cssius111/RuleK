# 🧪 测试Agent - 测试代码规则

## 继承主Agent规则
必须先读取 `/MAIN_AGENT.md`

## 测试特定规则

### 目录结构
```
tests/
├── unit/           # 单元测试
├── integration/    # 集成测试
├── e2e/           # 端到端测试
├── fixtures/      # 测试数据
└── conftest.py    # pytest配置
```

### 测试操作规则

#### 1. 测试文件位置
```python
# ✅ 正确位置
源文件: src/core/game.py
测试文件: tests/unit/test_game.py

源文件: web/backend/services/game_service.py
测试文件: tests/integration/test_game_service.py

# ❌ 错误位置
/test_game.py          # 不在根目录
/game_test.py          # 用test_前缀
/test_game_new.py      # 不要创建new版本
```

#### 2. 修改测试
```python
# ✅ 正确 - 直接修改
edit_file("tests/unit/test_game.py", fixes)

# ❌ 错误 - 创建新文件
write_file("tests/unit/test_game_fixed.py")
write_file("tests/unit/test_game_v2.py")
```

#### 3. 测试命名规范
```python
# 测试类
class TestGameEngine:    # ✅ Test开头
class GameEngineTest:    # ❌ Test在后面

# 测试方法
def test_create_rule():  # ✅ test_开头
def test_should_create_rule_when_valid():  # ✅ 描述性
def create_rule_test():  # ❌ 没有test_前缀
```

### Pytest规范
```python
# 使用fixture
@pytest.fixture
def game_state():
    return GameState()

# 参数化测试
@pytest.mark.parametrize("input,expected", [
    (1, True),
    (0, False),
])
def test_validation(input, expected):
    assert validate(input) == expected
```

### 测试覆盖率
- 目标覆盖率: >80%
- 关键模块: >90%
- 运行: `pytest --cov=src`

### 禁止操作
- ❌ 在测试中硬编码路径
- ❌ 创建 `test_all.py`（分模块测试）
- ❌ 修改 conftest.py 除非必要