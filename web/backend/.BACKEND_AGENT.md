# 🌐 后端Agent - 后端代码规则

## 继承主Agent规则
必须先读取 `/MAIN_AGENT.md`

## 后端特定规则

### 目录结构
```
web/backend/
├── app.py           # 主应用（不要创建app_new.py！）
├── models/          # 数据模型
├── services/        # 业务服务
├── api/            # API路由
├── utils/          # 工具函数
└── static/         # 静态文件
```

### 后端操作规则

#### 1. 修改主应用文件
```python
# ✅ 正确 - 修改app.py
1. read_file("web/backend/app.py")
2. edit_file("web/backend/app.py", changes)

# ❌ 错误 - 创建新文件
- app_enhanced.py
- app_with_websocket.py
- new_app.py
```

#### 2. 添加新服务
```python
# ✅ 正确位置
web/backend/services/streaming_service.py  # 具体功能命名

# ❌ 错误位置
web/backend/new_service.py  # 不在services目录
web/backend/service2.py     # 无意义的命名
```

#### 3. API路由规则
- 路由文件放在 `api/` 目录
- RESTful命名：`game_routes.py`
- WebSocket: `ws_routes.py`

### FastAPI特定规范
```python
# 导入顺序
1. Python标准库
2. FastAPI相关
3. 第三方库
4. 项目内部模块

# 路由命名
@app.get("/api/games")      # 复数资源
@app.get("/api/game/{id}")  # 单个资源
@app.websocket("/ws")        # WebSocket端点
```

### 服务层规范
```python
# 服务类命名
class GameService:      # ✅ 正确
class GameManager:      # ✅ 也可以
class game_service:     # ❌ 类名要大写
class GameSvc:         # ❌ 不要缩写
```

### 禁止操作
- ❌ 创建 `run_server.py`（已有 app.py）
- ❌ 创建 `main.py`（使用 app.py）
- ❌ 在backend根目录堆放文件（使用子目录）