# æµ‹è¯•é—®é¢˜ä¿®å¤è¯´æ˜

## ğŸ”§ å·²ä¿®å¤çš„é—®é¢˜

### 1. **å¼‚æ­¥æµ‹è¯•è¢«è·³è¿‡**
- **é—®é¢˜**: `async def` æµ‹è¯•å‡½æ•°è¢«è·³è¿‡ï¼Œæç¤ºéœ€è¦å®‰è£…å¼‚æ­¥æ’ä»¶
- **è§£å†³**: 
  - å·²åœ¨ `requirements.txt` ä¸­åŒ…å« `pytest-asyncio==0.21.1`
  - å·²åœ¨ `pyproject.toml` ä¸­é…ç½® `asyncio_mode = "auto"`
  - æ‰€æœ‰å¼‚æ­¥æµ‹è¯•å·²æ·»åŠ  `@pytest.mark.asyncio` è£…é¥°å™¨

### 2. **æµ‹è¯•è¿”å›å€¼è­¦å‘Š**
- **é—®é¢˜**: æµ‹è¯•å‡½æ•°è¿”å›äº†å€¼ï¼Œpytest æœŸæœ›ä¸è¿”å›ä»»ä½•å€¼
- **è§£å†³**: å·²ç§»é™¤æ‰€æœ‰æµ‹è¯•å‡½æ•°ä¸­çš„ `return True` è¯­å¥

### 3. **Pydantic å¼ƒç”¨è­¦å‘Š**
- **é—®é¢˜**: ä½¿ç”¨äº† Pydantic v1 çš„è¯­æ³•
- **è§£å†³**: 
  - å°† `@validator` æ”¹ä¸º `@field_validator`
  - å°† `class Config` æ”¹ä¸º `model_config = ConfigDict()`

### 4. **é¡¹ç›®æ–‡ä»¶ç»„ç»‡**
- **é—®é¢˜**: æµ‹è¯•æ–‡ä»¶å’Œé…ç½®åˆ†æ•£
- **è§£å†³**: å·²åˆ›å»ºæ¸…æ™°çš„é¡¹ç›®ç»“æ„å’Œç»´æŠ¤è„šæœ¬

## ğŸš€ å¦‚ä½•è¿è¡Œæµ‹è¯•

### å¿«é€Ÿè¿è¡Œ
```bash
python rulek.py test
```

### ç›´æ¥ä½¿ç”¨ pytest
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/ -v

# åªè¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/unit/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest tests/unit/test_game.py -v

# è¿è¡Œå¸¦è¦†ç›–ç‡çš„æµ‹è¯•
pytest tests/ --cov=src --cov-report=term-missing
```

## ğŸ“‹ ç¯å¢ƒè¦æ±‚

1. **Python ç‰ˆæœ¬**: 3.8+
2. **å¿…è¦ä¾èµ–**:
   ```bash
   pip install -r requirements.txt
   ```

3. **ç¯å¢ƒå˜é‡é…ç½®**:
   ```bash
   cp .env.example .env
   # ç¼–è¾‘ .env æ–‡ä»¶ï¼Œæ·»åŠ ä½ çš„ DEEPSEEK_API_KEY
   ```

## âš ï¸ å·²çŸ¥è­¦å‘Šï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰

1. **Pydantic ConfigDict è­¦å‘Š**: è¿™æ˜¯ Pydantic v2 è¿ç§»çš„ä¸€éƒ¨åˆ†ï¼Œä¸å½±å“åŠŸèƒ½
2. **JSON encoders è­¦å‘Š**: å·²çŸ¥çš„å¼ƒç”¨è­¦å‘Šï¼ŒåŠŸèƒ½æ­£å¸¸

## ğŸ§¹ é¡¹ç›®ç»´æŠ¤

æ¸…ç† pytest ç¼“å­˜ï¼š
```bash
pytest --cache-clear
```

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡

æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šï¼š
```bash
pytest tests/ --cov=src --cov-report=html
# ç„¶åæ‰“å¼€ htmlcov/index.html
```

## ğŸ› é—®é¢˜æ’æŸ¥

å¦‚æœæµ‹è¯•ä»ç„¶å¤±è´¥ï¼š

1. **ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œæµ‹è¯•**
2. **æ£€æŸ¥ Python è·¯å¾„**:
   ```python
   import sys
   print(sys.path)
   ```
3. **éªŒè¯å¼‚æ­¥æ”¯æŒ**:
   ```bash
   python -m pytest --version
   pip show pytest-asyncio
   ```
4. **æ¸…ç†ç¼“å­˜**:
   ```bash
   pytest --cache-clear
   ```

## âœ… ä¸‹ä¸€æ­¥

1. æ‰€æœ‰æµ‹è¯•åº”è¯¥èƒ½æ­£å¸¸è¿è¡Œ
2. å¯ä»¥å¼€å§‹å¼€å‘æ–°åŠŸèƒ½
3. è®°å¾—ä¸ºæ–°åŠŸèƒ½æ·»åŠ æµ‹è¯•
4. ä½¿ç”¨ Mock æ¨¡å¼å¯ä»¥ä¸ä¾èµ– API è¿›è¡Œæµ‹è¯•
