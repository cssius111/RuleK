# RuleK 项目 Web UI 详细规划

以下规划以现有 CLI 流程为基础，将所有功能转换为清晰的网页结构，并说明各页面之间的导航关系。

---

## 1. **首页 / 主菜单**

**功能：**
- 展示项目横幅与简介。
- 提供以下入口：
  - “开始新游戏”
  - “加载存档”
  - “帮助/说明”
  - “制作人员”（可选）
  - “退出”（返回主页或关闭页面）

**导航：**
- “开始新游戏” → `新游戏配置页`
- “加载存档” → `加载游戏页`
- “帮助/说明” → `帮助页`
- “制作人员” → `制作人员页`

---

## 2. **新游戏配置页**

**功能：**
- 输入或选择初始参数：
  - 初始恐惧点数（默认1000）
  - 初始 NPC 数量（默认4）
  - 难度级别（easy / normal / hard）
  - 是否启用 AI 功能
- 显示当前配置摘要，提供“确认开始”按钮。

**导航：**
- “确认开始” → 初始化游戏并进入 `游戏主界面（准备阶段）`
- “返回” → 返回 `首页 / 主菜单`

---

## 3. **加载游戏页**

**功能：**
- 扫描 `data/saves/` 目录，列出所有存档（按名称和时间）。
- 可搜索/选择某个存档。

**导航：**
- 选择存档并点击“加载” → 加载状态后进入 `游戏主界面（准备阶段）`
- “删除存档”（可选） → 删除指定存档后刷新列表
- “返回” → 返回 `首页 / 主菜单`

---

## 4. **游戏主界面（准备阶段 Dashboard）**

**功能区块：**
1. **顶部状态栏**
   - 显示当前回合、天数、时间段、游戏模式（幕后/亲自）、恐惧点数、存活NPC等。
2. **最近事件**
   - 显示最新数条事件日志。
3. **核心操作按钮**  
   （根据是否启用 AI 自动调整）：
   - “规则管理”
   - “查看 NPC 状态”
   - “切换模式（幕后/亲自）”
   - “开始回合” → 进入行动阶段
   - 若启用 AI：
     - “AI 回合”
     - “保存游戏”
     - “返回主菜单”
   - 若未启用 AI：
     - “保存游戏”
     - “返回主菜单”

**导航：**
- “规则管理” → `规则管理页`
- “查看 NPC 状态” → `NPC 状态页`
- “切换模式” → 刷新当前页但更新模式状态
- “开始回合” → `行动阶段页`
- “AI 回合” → `AI 回合页`
- “保存游戏” → `保存弹窗` → 保存成功后仍停留在此
- “返回主菜单” → `首页 / 主菜单`

---

## 5. **规则管理页**

**功能：**
- 列表展示现有激活规则（名称、等级、简述）。
- 操作按钮：
  - “创建自定义规则”
  - “使用模板创建”
  - 若启用 AI： “AI 解析规则”
  - “升级规则”（暂未实现，可显示禁用状态）
  - “返回”

**导航：**
- “创建自定义规则” → `自定义规则创建页`
- “使用模板创建” → `规则模板选择页`
- “AI 解析规则” → `AI 规则解析页`
- “升级规则” → 可跳转到占位页面或弹出提示“功能尚未实现”
- “返回” → 返回 `游戏主界面（准备阶段）`

---

## 6. **自定义规则创建页**

**功能：**
- 按向导式表单逐步收集信息：
  1. 规则名称
  2. 规则描述
  3. 触发条件类型（动作 / 时间 / 地点 / 物品）
  4. 触发概率
  5. 效果类型（即时死亡、增加恐惧、降低理智、传送、获得物品等）
  6. 可选“破绽”设置（物品免疫、时间免疫、地点免疫）
  7. 冷却时间
- 实时计算/显示估算成本。
- 最终展示规则预览，提供“确认创建”按钮。

**导航：**
- “确认创建” → 保存规则并返回 `规则管理页`
- “取消”/“返回” → 返回 `规则管理页`

---

## 7. **规则模板选择页**

**功能：**
- 列出 `RULE_TEMPLATES` 中所有模板（名称、描述、成本）。
- 可展开查看详细信息。
- 选中后显示成本及恐惧点数检查提示。

**导航：**
- “确认创建” → 创建规则并返回 `规则管理页`
- “取消” → 返回 `规则管理页`

---

## 8. **AI 规则解析页**

**功能：**
- 文本输入框：玩家用自然语言描述规则。
- “解析”按钮调用后端 AI 接口。
- 显示解析结果：
  - 规则名、预估成本、难度、预计恐惧收益
  - 潜在漏洞列表
  - AI 改进建议
- 若恐惧点数足够，提供“创建规则”按钮。

**导航：**
- “创建规则” → 保存规则并返回 `规则管理页`
- “返回” → 返回 `规则管理页`

---

## 9. **NPC 状态页**

**功能：**
- 表格列出所有 NPC：名字、位置、HP、理智、恐惧值、状态（存活/死亡）。
- 提供筛选或排序。

**导航：**
- “返回” → `游戏主界面（准备阶段）`

---

## 10. **AI 回合页**

**功能：**
- 说明：“AI 将生成对话和行动计划”。
- “开始 AI 回合”按钮 → 调用 AI 生成计划。
- 显示生成内容：
  - NPC 对话列表
  - 行动计划（包含 NPC、行动、目标、原因）
- “执行这些行动？”确认按钮：
  - 执行后直接跳至 `结算阶段页`
- “取消”/“返回” → 回到 `游戏主界面（准备阶段）`

---

## 11. **对话阶段页**

**触发：** 游戏流程到达对话阶段（早/晚对话）

**功能：**
- 若启用 AI：展示 AI 生成的 NPC 对话内容。
- 未启用或失败时：展示系统预设的备选对话。
- “继续”按钮进入行动阶段。

**导航：**
- “继续” → `行动阶段页`

---

## 12. **行动阶段页**

**功能：**
- 自动轮播显示每个存活 NPC 的行动：
  - 行动描述与结果
  - 若触发规则则展示规则名称及效果信息
- 日志形式滚动呈现。
- “继续”按钮结束行动阶段，进入结算。

**导航：**
- “继续” → `结算阶段页`

---

## 13. **结算阶段页**

**功能：**
- 展示本回合统计：
  - 触发规则次数
  - 存活 NPC 数
  - 当前恐惧点数
- 如果启用 AI：提供“生成回合叙事？”选项 → 显示生成文本。
- “进入下一回合”按钮将阶段切回准备阶段。

**导航：**
- “进入下一回合” → `游戏主界面（准备阶段）`

---

## 14. **保存弹窗**

**功能：**
- 输入存档名称并确认保存。
- 成功后提示存档路径。

**导航：**
- 完成后关闭弹窗，返回 `游戏主界面（准备阶段）`

---

## 15. **游戏结束页**

**触发条件：** 所有 NPC 死亡或其它终止条件。

**功能：**
- 显示结束原因。
- 显示游戏总结（总回合数、存活天数、最终恐惧积分、创建规则数）。
- “返回主菜单”按钮。

**导航：**
- “返回主菜单” → `首页 / 主菜单`

---

## 16. **帮助页**

**功能：**
- 展示 CLI 中的帮助信息：操作说明、规则系统、游戏目标等。
- 文字排版清晰，可能带有图片或例子。

**导航：**
- “返回” → `首页 / 主菜单`

---

## 17. **制作人员页（可选）**

**功能：**
- 列出项目背景、制作团队、版本信息、致谢。

**导航：**
- “返回” → `首页 / 主菜单`

---

## 18. **（扩展）项目管理页**

**若需将 `tools/manage.py` 功能整合：**

**功能：**
- “查看项目状态” → 显示系统信息、环境配置等（调用 status 脚本结果）。
- “清理项目” → 执行清理脚本并返回结果。
- “启动服务器” → 启动 Web 服务（前端可提示已启动）。
- “查看清理指南” → 展示对应文档。
- “返回”

**导航：**
- 各项操作执行后仍回到此页。
- “返回” → `首页 / 主菜单`

---

# 页面之间的总体流程概览

```
首页 → 新游戏配置页 → 游戏主界面（准备阶段）
      ↘ 加载游戏页 → 游戏主界面（准备阶段）

游戏主界面（准备阶段） 
  → 规则管理页 → 自定义规则创建页 / 规则模板选择页 / AI 规则解析页 → 规则管理页 → 准备阶段
  → NPC 状态页 → 准备阶段
  → 切换模式（内部操作）
  → 开始回合 → 行动阶段页 → 结算阶段页 → 准备阶段
  → AI 回合页 → （对话 + 行动 + 结算）→ 准备阶段
  → 保存弹窗 → 准备阶段
  → 返回主菜单 → 首页

游戏任何阶段 NPC 全灭 → 游戏结束页 → 首页
```

---

## 总结

该 Web UI 方案完整覆盖了 CLI 游戏中的全部功能，清晰地划分每个页面、操作与跳转逻辑。若后续需要扩展 AI、项目管理等功能，可在现有结构上继续扩展。整个界面设计应注重即时反馈与状态展示，使玩家在 Web 环境中获得与 CLI 相同甚至更佳的体验。

