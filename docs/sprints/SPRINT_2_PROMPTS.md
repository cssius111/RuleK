# Sprint 2 MCP开发Prompts集合

## 🎯 Sprint 2 目标
- AI对话和叙事系统集成
- 地图系统实现
- 游戏内容扩充
- Web UI原型（可选）

---

## 1. DeepSeek API集成

### Prompt 1.1: 创建API客户端
```
基于已有的游戏架构，创建DeepSeek API客户端模块。

要求：
1. 文件路径：src/api/deepseek_client.py
2. 实现异步API调用，支持重试机制
3. 包含以下核心方法：
   - generate_dialogue() - 生成NPC对话
   - evaluate_rule() - 评估规则设计
   - narrate_events() - 生成事件叙述
4. 实现响应缓存机制减少API调用
5. 添加mock模式用于离线测试
6. 使用已安装的httpx库（如需要）

参考现有代码风格，确保与GameStateManager良好集成。
```

### Prompt 1.2: 对话生成系统
```
扩展NPC系统，添加基于AI的对话功能。

需求：
1. 在src/core/dialogue_system.py创建对话管理器
2. 根据NPC性格、当前状态、记忆生成对话
3. 实现对话轮次管理（早间对话、夜间对话、紧急对话）
4. 对话要反映：
   - NPC的恐惧程度
   - 对其他NPC的信任度
   - 是否发现了规则线索
5. 集成到main_game.py的游戏循环中
6. 添加对话历史记录功能

输入示例：
- NPC状态：{fear: 60, sanity: 70, personality: {courage: 3}}
- 场景：刚目睹同伴死亡
- 输出：恐惧但试图保持理性的对话
```

### Prompt 1.3: 叙事生成器
```
创建游戏叙事生成系统，将游戏事件转化为小说化描述。

要求：
1. 文件：src/core/narrator.py
2. 将事件列表转换为连贯的叙事段落
3. 支持不同的叙事风格（恐怖、悬疑、黑色幽默）
4. 根据事件严重程度调整描述详细度
5. 整合到回合结算阶段
6. 输出格式：
   - 章节标题
   - 环境描述
   - 事件叙述
   - 氛围渲染

示例事件：
[{type: "rule_triggered", npc: "小明", rule: "镜中恶魔", result: "death"}]
输出：深夜的寂静被一声凄厉的尖叫撕裂...
```

---

## 2. 地图系统实现

### Prompt 2.1: 地图数据模型
```
创建地图系统的数据模型和管理器。

要求：
1. 文件：src/models/map.py
2. 实现Area类，包含：
   - 区域ID和名称
   - 可容纳NPC数量
   - 连接的其他区域
   - 区域特殊属性（黑暗、寒冷等）
   - 可交互物品列表
3. 实现MapManager，功能：
   - 加载地图配置
   - NPC移动验证
   - 区域事件触发
   - 路径寻找（简单版）
4. 创建默认地图：客厅、走廊、卧室x2、浴室、厨房
5. 支持JSON配置文件加载地图

确保与现有的NPC location属性兼容。
```

### Prompt 2.2: NPC移动系统
```
扩展NPC系统，实现基于地图的移动行为。

需求：
1. 修改src/models/npc.py，添加移动相关方法
2. 实现移动决策逻辑：
   - 恐惧时倾向于人多的地方
   - 好奇时探索新区域
   - 理性时有目的地移动
3. 添加移动限制：
   - 体力消耗
   - 某些区域需要特定物品（如钥匙）
4. 更新NPC的decide_action()方法
5. 在game_state.py中跟踪所有NPC位置

保持向后兼容性，不破坏现有游戏逻辑。
```

---

## 3. 游戏内容扩充

### Prompt 3.1: 规则模板扩展
```
扩充规则模板库，添加10个新的有趣规则。

要求：
1. 在src/models/rule.py的RULE_TEMPLATES中添加
2. 规则类型覆盖：
   - 时间相关（特定时刻触发）
   - 地点相关（特定房间）
   - 互动相关（NPC之间）
   - 物品相关（使用道具）
   - 连锁规则（触发其他规则）
3. 每个规则都要有独特的恐怖氛围
4. 包含至少2个破绽设计
5. 成本在50-300之间平衡

示例规则：
- "电话铃声"：深夜电话响起，接听者消失
- "群体幻觉"：3人以上在同一房间时集体疯狂
- "影子模仿"：做出特定动作后影子会延迟模仿并攻击
```

### Prompt 3.2: 事件系统
```
创建随机事件系统，增加游戏的不可预测性。

要求：
1. 文件：src/core/event_system.py
2. 事件类型：
   - 环境事件（停电、异响、温度下降）
   - NPC事件（噩梦、幻觉、发现线索）
   - 物品事件（道具出现、损坏）
   - 特殊事件（灵异现象）
3. 事件触发条件和概率计算
4. 事件对游戏状态的影响
5. 与叙事系统集成
6. 可通过JSON配置事件

确保事件系统不会过度干扰核心游戏循环。
```

---

## 4. Web UI原型（可选）

### Prompt 4.1: FastAPI后端
```
基于现有游戏逻辑创建Web API。

要求：
1. 文件：web/app.py
2. 使用FastAPI框架
3. 实现WebSocket实时通信
4. API端点：
   - POST /game/new - 创建新游戏
   - GET /game/{id}/state - 获取游戏状态
   - POST /game/{id}/rule - 创建规则
   - POST /game/{id}/turn - 推进回合
   - WebSocket /game/{id}/events - 实时事件流
5. 保持游戏逻辑在后端，前端只负责显示
6. 添加CORS支持

复用现有的游戏核心代码，不要重写逻辑。
```

### Prompt 4.2: 前端界面
```
创建简单的Web界面原型。

要求：
1. 文件：web/static/index.html, game.js, style.css
2. 使用原生JS或Vue.js
3. 界面组件：
   - 恐惧点数显示
   - NPC状态卡片
   - 规则创建面板
   - 游戏日志滚动显示
   - 地图可视化（简单版）
4. 实时更新游戏状态
5. 响应式设计，支持手机访问
6. 暗色主题，符合恐怖氛围

可以先做静态原型，后续再连接API。
```

---

## 5. 优化和测试

### Prompt 5.1: 性能优化
```
分析并优化现有代码性能。

任务：
1. profile当前游戏循环，找出瓶颈
2. 优化NPC决策算法
3. 实现规则触发的索引优化
4. 添加游戏状态的增量更新
5. 优化文件I/O操作
6. 添加内存使用监控

保持代码可读性，不要过度优化。
```

### Prompt 5.2: 单元测试
```
为Sprint 2新功能编写单元测试。

要求：
1. 测试文件放在tests/unit/目录
2. 使用pytest框架
3. 测试覆盖：
   - API客户端的mock测试
   - 地图系统的移动验证
   - 事件系统的触发逻辑
   - 对话生成的边界情况
4. 添加集成测试验证整体流程
5. 测试覆盖率目标：80%

为关键功能编写测试用例，确保稳定性。
```

---

## 使用建议

1. **顺序执行**：建议按照1→2→3的顺序开发
2. **增量集成**：每完成一个模块就集成测试
3. **保持兼容**：新功能不要破坏Sprint 1的成果
4. **Mock优先**：先用Mock实现，再接入真实API
5. **及时保存**：使用Git管理版本变化

## 快速启动命令

```bash
# 创建Sprint 2分支
git checkout -b sprint-2

# 安装新依赖
pip install httpx fastapi uvicorn

# 运行测试
python test_game.py

# 启动开发
# 将上述prompt复制给AI助手，开始开发！
```
